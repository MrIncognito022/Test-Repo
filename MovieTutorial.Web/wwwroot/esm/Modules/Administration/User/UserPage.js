import{a as I}from"../../../_chunks/chunk-NT2LZAZS.js";import{a as g}from"../../../_chunks/chunk-O7EIRAGN.js";import{h as x,k as C,l as y,m as h,n as e,o as P}from"../../../_chunks/chunk-Q4COIZBO.js";import{a as m,b as o,c as f,e as i}from"../../../_chunks/chunk-VVOU4364.js";var b=o(i(),1);var v=o(i(),1),R=o(i(),1);var U=o(i(),1),t=o(i(),1);var c=class extends U.TemplatedDialog{constructor(r){super(r);this.permissions=new I(this.byId("Permissions"),{showRevoke:!0}),h.List({UserID:this.options.userID,Module:null,Submodule:null},s=>{this.permissions.value=s.Entities}),h.ListRolePermissions({UserID:this.options.userID,Module:null,Submodule:null},s=>{this.permissions.rolePermissions=s.Entities}),this.permissions.implicitPermissions=(0,t.getRemoteData)("Administration.ImplicitPermissions"),this.dialogTitle=(0,t.format)((0,t.localText)("Site.UserPermissionDialog.DialogTitle"),this.options.username)}getDialogButtons(){return[{text:(0,t.localText)("Dialogs.OkButton"),cssClass:"btn btn-primary",click:r=>{h.Update({UserID:this.options.userID,Permissions:this.permissions.value,Module:null,Submodule:null},s=>{this.dialogClose(),window.setTimeout(()=>(0,t.notifySuccess)((0,t.localText)("Site.UserPermissionDialog.SaveSuccess")),0)})}},{text:(0,t.localText)("Dialogs.CancelButton"),click:()=>this.dialogClose()}]}getTemplate(){return'<div id="~_Permissions"></div>'}};m(c,"UserPermissionDialog");var d=o(i(),1),u=o(i(),1);var n=class extends d.EntityDialog{constructor(){super();this.form=new y(this.idPrefix);this.form.Password.change(()=>{d.EditorUtils.setRequired(this.form.PasswordConfirm,this.form.Password.value.length>0)}),this.form.Password.addValidationRule(this.uniqueName,r=>{if(this.form.Password.value.length<6)return(0,u.format)((0,u.localText)(g.Validation.MinRequiredPasswordLength),6)}),this.form.PasswordConfirm.addValidationRule(this.uniqueName,r=>{if(this.form.Password.value!=this.form.PasswordConfirm.value)return(0,u.localText)(g.Validation.PasswordConfirmMismatch)})}getFormKey(){return y.formKey}getIdProperty(){return e.idProperty}getIsActiveProperty(){return e.isActiveProperty}getLocalTextPrefix(){return e.localTextPrefix}getNameProperty(){return e.nameProperty}getService(){return P.baseUrl}getToolbarButtons(){let r=super.getToolbarButtons();return r.push({title:(0,u.localText)(g.Site.UserDialog.EditPermissionsButton),cssClass:"edit-permissions-button",icon:"fa-lock text-green",onClick:()=>{new c({userID:this.entity.UserId,username:this.entity.Username}).dialogOpen()}}),r}updateInterface(){super.updateInterface(),this.toolbar.findButton("edit-permissions-button").toggleClass("disabled",this.isNewOrDeleted())}afterLoadEntity(){super.afterLoadEntity(),this.form.Password.element.toggleClass("required",this.isNew()).closest(".field").find("sup").toggle(this.isNew()),this.form.PasswordConfirm.element.toggleClass("required",this.isNew()).closest(".field").find("sup").toggle(this.isNew())}};m(n,"UserDialog"),n=f([d.Decorators.registerClass()],n);var l=class extends v.EntityGrid{getColumnsKey(){return C.columnsKey}getDialogType(){return n}getIdProperty(){return e.idProperty}getIsActiveProperty(){return e.isActiveProperty}getLocalTextPrefix(){return e.localTextPrefix}getService(){return P.baseUrl}constructor(a){super(a)}getDefaultSortBy(){return[e.Fields.Username]}createIncludeDeletedButton(){}getColumns(){var a=super.getColumns(),r=(0,R.tryFirst)(a,p=>p.field==e.Fields.Roles);if(r){var s;x.getLookupAsync().then(p=>{s=p,this.slickGrid.invalidate()}),r.format=p=>{if(!s)return'<i class="fa fa-spinner"></i>';var D=(p.value||[]).map(S=>(s.itemById[S]||{}).RoleName||"");return D.sort(),D.join(", ")}}return a}};m(l,"UserGrid"),l=f([v.Decorators.registerClass()],l);$(function(){(0,b.initFullHeightGridPage)(new l($("#GridDiv")).element)});
//# sourceMappingURL=UserPage.js.map
